# 项目开发文档 (Project Documentation)

> 最后更新: 2026-02-07
> 文档状态: 活跃

## 1. 项目概览
本项目是一个基于 AI 的全栈 Web 应用开发平台（类似 Vercel v0 或 Bolt.new），允许用户通过自然语言描述需求，实时生成、预览并部署 React 应用。

### 核心价值
- **自然语言编程**: 用户只需描述想法，AI 自动生成代码。
- **实时预览**: 集成沙箱环境，所见即所得。
- **一键部署**: 支持将生成的应用发布为公开链接。
- **全栈架构**: 包含完整的用户认证、项目管理和持久化存储。

---

## 2. 技术架构 (Architecture)

### 前端架构
- **框架**: [Next.js 14 (App Router)](https://nextjs.org/) - 提供服务端渲染 (SSR) 和 静态生成 (SSG) 能力。
- **语言**: TypeScript - 保证代码健壮性和类型安全。
- **UI 组件库**: [Shadcn UI](https://ui.shadcn.com/) + [Tailwind CSS v4](https://tailwindcss.com/) - 现代化的原子类样式解决方案。
- **状态管理**: React Hooks (`useChat`, `useState`) + URL State (主要依赖服务端状态和简单本地状态)。
- **代码预览**: [@codesandbox/sandpack-react](https://sandpack.codesandbox.io/) - 浏览器端即时运行 React 代码。

### 后端架构
- **API 层**: Next.js Server Actions - 处理表单提交、数据库操作，替代传统 API 路由。
- **数据库**: [Supabase (PostgreSQL)](https://supabase.com/) - 提供关系型数据库和实时订阅能力。
- **认证**: Supabase Auth - 处理用户注册、登录、会话管理 (Cookie-based)。
- **ORM**: 直接使用 `@supabase/supabase-js` 客户端进行查询，结合 SQL RLS 策略保证安全。

### AI 基础设施
- **模型聚合**: OpenRouter API - 统一接入不同大模型接口。
- **当前模型**: `google/gemini-2.0-flash-lite-preview-02-05:free` - 高效且免费。
- **SDK**: Vercel AI SDK (`ai` package) - 处理流式传输 (Streaming) 和 UI 状态同步。

### 部署架构
- **容器化**: Docker - 统一开发和生产环境。
- **远程服务器**: 34.72.125.220 (运行 Docker 容器)。
- **反向代理/网关**: Kong (Supabase 内置) 端口映射至 `36666`。

---

## 3. 已完成功能 (Completed Features)

详细的功能实现文档已整理至 `任务文档/已完成功能/` 目录下：

1.  [项目初始化与基础架构](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/01_项目初始化.md)
2.  [数据库设计与安全](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/02_数据库设计.md)
3.  [布局与UI交互](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/03_布局与UI.md)
4.  [核心Chat与AI集成](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/04_核心功能与AI.md)
5.  [远程部署指南](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/05_部署与运维.md)
6.  [沙盒环境与终端](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/06_沙盒环境与终端.md)
7.  [后端异步处理与前端轮询](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/07_后端异步处理与前端轮询.md)
8.  [AI 工具集与沙箱执行](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/08_AI工具集.md)
9.  [文件浏览与目录树](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/09_文件浏览功能.md)
10. [AI 状态实时反馈 (详细设计)](file:///Users/aaa/Documents/study-demo/任务文档/详细任务/3.2_AI状态实时反馈.md)
11. [项目重命名功能](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/11_项目重命名功能.md)
12. [新建项目命名与默认值](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/12_新建项目命名功能.md)
13. [OpenRouter集成与终端修复](file:///Users/aaa/Documents/study-demo/任务文档/已完成功能/13_OpenRouter集成与终端修复.md)

### 关键里程碑
- ✅ **MVP 发布**: 完成了从登录到代码生成的完整闭环。
- ✅ **AI 格式兼容**: 解决了 Gemini `parts` 格式与 Vercel AI SDK 的兼容性问题。
- ✅ **布局优化**: 实现了类似于 IDE 的可拖拽三栏布局，提升了用户体验。
- ✅ **稳定性提升**: 实现了后端异步处理和前端轮询，彻底解决了长文本生成的超时问题。

---

## 4. 开发流程 (Development Workflow)

### 4.1 环境准备
1.  **Node.js**:确需版本 `^20.0.0`。
2.  **包管理器**: 推荐使用 `pnpm` 或 `npm`。
3.  **Python**: (可选) 用于部分辅助脚本，建议使用虚拟环境。

### 4.2 本地开发 (Local Development)
1.  **克隆代码**:
    ```bash
    git clone https://github.com/likecu/atoms-demo.git
    cd atoms-demo
    ```
2.  **安装依赖**:
    ```bash
    npm install
    ```
3.  **配置环境变量**:
    复制 `.env.example` 为 `.env.local` 并填入以下 Docker/Supabase 信息：
    ```env
    NEXT_PUBLIC_SUPABASE_URL=http://34.72.125.220:36666
    NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    OPENROUTER_API_KEY=sk-or-v1-...
    ```
4.  **启动开发服务器**:
    ```bash
    npm run dev
    ```
    访问 `http://localhost:3000`。

### 4.3 数据库管理
由于使用了远程 Docker 版 Supabase：
- **查看数据**: 访问 `http://34.72.125.220:36666` (Supabase Dashboard)。
- **Schema 变更**:
    - 推荐在本地编写 SQL 迁移脚本。
    - 通过 Dashboard 的 SQL Editor 执行。
    - 或者是使用 `supabase-cli` 链接远程项目 (需额外配置)。

### 4.4 代码提交与同步
1.  **Git 提交**:
    ```bash
    git add .
    git commit -m "feat: description"
    git push origin main
    ```
2.  **远程更新**:
    - 登录远程服务器 (`ssh milk@34.72.125.220`)。
    - 进入目录 `/home/milk/atoms-demo`。
    - 拉取最新代码: `git pull origin main`。
    - 重新构建容器: `docker build -t atoms-demo:latest .`。
    - 重启服务: `docker restart atoms-demo`。

### 4.5 最佳实践
- **Server Actions**: 所有数据库写操作必须在 Server Actions 中进行，并包含错误处理。
- **UI 组件**: 优先复用 `src/components/ui` 下的 Shadcn 组件。
- **AI Prompt**: 修改 System Prompt 请前往 `src/lib/ai/prompts.ts` (假设位置，需确认)。
- **类型安全**: 尽量避免使用 `any`，定义完整的 Interface。

---

## 5. 项目目录结构
```
src/
├── app/                 # Next.js App Router 页面路由
│   ├── chat/            # 聊天页面
│   ├── dashboard/       # 项目列表页
│   ├── login/           # 登录页
│   └── api/             # API 路由 (主要用于 Auth callback)
├── components/          # React 组件
│   ├── ui/              # Shadcn 基础组件
│   ├── chat/            # 聊天相关业务组件
│   ├── layout/          # 布局组件 (Sidebar, Header)
│   └── preview/         # 代码预览组件
├── lib/                 # 工具函数与核心逻辑
│   ├── actions/         # Server Actions (后端逻辑)
│   ├── hooks/           # Custom React Hooks
│   ├── supabase/        # Supabase 客户端配置
│   └── utils.ts         # 通用工具
└── types/               # TypeScript 类型定义
```
