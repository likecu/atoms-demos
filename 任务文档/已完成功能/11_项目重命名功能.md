# 项目重命名功能实现文档

## 1. 需求背景
原有的项目管理功能中，项目名称在创建后无法修改，只能通过数据库手动调整。为了提升用户体验，增加了项目重命名功能。

## 2. 功能设计
重命名功能通过两个入口提供：
1. **仪表盘 (Dashboard)**: 在项目卡片的更多操作菜单中，点击“重命名”弹出对话框进行修改。
2. **聊天页面 (Chat Page)**: 在顶部标题栏中，点击标题可直接进行原位编辑（Click-to-Edit）。

## 3. 技术实现

### 3.1 后端实现 (Server Actions)
- **文件**: `src/lib/actions/project.ts`
- **函数**: `updateProjectName(id: string, name: string)`
- **逻辑**:
    - 验证用户登录状态。
    - 使用 Supabase 客户端更新 `projects` 表的 `name` 字段。
    - 使用 `revalidatePath` 刷新 `/dashboard` 和 `/chat/[id]` 路径的页面缓存，确保数据一致性。

### 3.2 前端实现 (UI Components)

#### 仪表盘交互
- **文件**: `src/components/dashboard/project-card.tsx`
- **组件**: 使用了自定义的 `Dialog` 和 `Input` 组件。
- **状态管理**: 
    - `showRenameDialog`: 控制对话框显示。
    - `newName`: 存储重命名输入的内容。
    - `isPending`: 使用 `useTransition` 处理异步状态，防止 UI 阻塞。

#### 聊天页面原位编辑
- **文件**: `src/app/chat/[id]/chat-page-client.tsx`
- **交互流程**:
    - 默认显示项目名称，悬浮显示编辑图标。
    - 点击标题切换为 `Input` 编辑模式。
    - 失去焦点 (`onBlur`) 或点击 `Enter` 触发保存。
    - 按下 `Escape` 键放弃修改并回退。
- **状态**: 
    - `isEditingName`: 切换显示/编辑模式。
    - `currentProjectName`: 实时双向绑定输入框。

## 4. 边界处理
- **空名称过滤**: 禁止将项目重命名为空字符串。
- **相同名称**: 如果用户修改后的名称与原名称一致，则不触发后端请求。
- **错误处理**: 如果数据库更新失败，会通过 `toast` 提示用户，并将 UI 回退到之前的名称。
