# 核心功能与AI集成 (已完成)

## 1. AI 对话系统
*   **Provider**: OpenRouter (聚合接口)。
*   **模型**: `google/gemini-2.0-flash-lite-preview-02-05:free` (免费且快速)。
*   **SDK**: Vercel AI SDK (`ai`, `@ai-sdk/react`, `@ai-sdk/openai`)。
*   **流式响应**: 实现 `streamText`，打字机效果。
*   **Prompt Engineering**: 系统提示词优化，指导 AI 生成 React 代码。
*   **兼容性处理**: 自定义 `convertPartsToContent` 函数处理 Gemini 的 `parts` 格式差异。

## 2. 消息持久化
*   **自动保存**: 用户发送的消息和 AI 返回的流式消息均自动写入 Supabase `messages` 表。
*   **历史加载**: 进入项目时自动从数据库加载历史上下文。

## 3. 代码生成与预览
*   **流程**: 用户描述需求 -> AI 生成代码 -> 解析器提取代码块 -> Sandpack 渲染。
*   **沙箱环境**: 使用 `@codesandbox/sandpack-react` 提供安全的浏览器端执行环境。
*   **代码保存**: 最新生成的代码会更新到 `projects` 表的 `current_code` 字段 (或关联表)。

## 4. 项目管理
*   **Dashboard**: `/dashboard` 页面展示用户所有项目列表。
*   **创建项目**: 使用 Server Actions (`createProject`) 创建新项目并跳转到 `/chat/[id]`。
*   **鉴权**: Middleware 保护 `/dashboard` 和 `/chat` 路由，未登录自动跳转。

## 5. 公开分享
*   **功能**: 将项目发布为只读公开链接。
*   **实现**: 生成唯一 Token，非登录用户可通过 `/share/[token]` 访问。
