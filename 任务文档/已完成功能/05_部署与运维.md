# 部署与运维 (已完成)

## Docker 部署配置

### Dockerfile 多阶段构建
- **阶段 1**: Dependencies - 安装 Node.js 依赖
- **阶段 2**: Builder - 构建 Next.js 应用
- **阶段 3**: Runner - 生产环境运行

### Docker Compose 编排
```yaml
services:
  app:
    build:
      args:
        - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
        - NEXT_PUBLIC_SUPABASE_ANON_KEY=${NEXT_PUBLIC_SUPABASE_ANON_KEY}
        - AUTH_SECRET=${AUTH_SECRET}
    ports:
      - "3000:3000"
```

### 环境变量配置
```bash
# .env.example (已提交到代码仓库)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
AUTH_SECRET=your-auth-secret-key-min-32-chars
NEXT_PUBLIC_APP_URL=http://localhost:3000
GEMINI_MODEL_ID=tngtech/deepseek-r1t2-chimera:free
```

### 常用命令
```bash
# 构建并启动
docker-compose up -d

# 查看日志
docker logs -f atoms-demo

# 重启服务
docker restart atoms-demo
```

---

## 远程服务器环境
*   **部署目录**: `/home/milk/atoms-demo`

## Supabase 部署
*   **方式**: Docker Compose (Self-hosted)。
*   **配置**: 
    *   API Gateway (Kong) 端口映射为 `36666` (用于外部访问)。
    *   Dashboard 和 API 服务均已启动。

## 应用部署
*   **容器化**: 项目包含 `Dockerfile`。
*   **运行命令**: 
    ```bash
    docker build -t atoms-demo:latest .
    docker run -d -p 3001:3000 --name atoms-demo atoms-demo:latest
    ```
*   **环境变量**: 容器运行时注入 `NEXT_PUBLIC_SUPABASE_URL` (指向服务器) 和 `NEXT_PUBLIC_SUPABASE_ANON_KEY`。

## 账号信息 (本地环境)
*   **测试账号**: `qwe`
*   **测试密码**: `qwe12345`
*   **运行端口**: `localhost:3000`
