# 16. 执行流重构与并行渲染 (Execution Flow Refactor)

## 1. 功能概述
重构了 AI 执行流（Execution Flow）组件，从原本的线性日志列表转变为支持**层级嵌套**和**并行执行**的可视化交互界面。此更新是为了更好地展示 Agentic Workflow（代理工作流）中主代理（Main Agent）与子代理（Sub-agent）之间的父子关系及并行任务。

## 2. 核心特性

### 2.1 层级化展示 (Hierarchical View)
- **树形结构**: 将扁平的日志流转化为树状结构，清晰展示 `dispatch_subagent` 产生的子任务。
- **Agent Card**: 子代理的执行上下文被封装在独立的 "Agent Card" 中，与主代理的日志视觉分离。
- **递归渲染**: 支持无限层级的代理嵌套（如：主代理 -> 研究代理 -> 浏览器代理）。

### 2.2 并行执行可视化 (Parallel Execution)
- **网格布局**: 当主代理连续调度多个子代理时（即并行任务），这些子代理的 Card 会以 `Grid` 布局并在同一行显示，直观体现并行性。
- **状态隔离**: 每个 Agent Card 拥有独立的状态指示器（运行中、成功、失败）。

### 2.3 交互优化
- **折叠/展开**: 用户可以折叠已完成的子代理 Card，减少屏幕占用。
- **详情侧边栏**: 点击任意日志节点或 Agent Card，可在右侧侧边栏查看完整的 JSON 元数据和长文本内容。
- **自动滚动**: 保持对最新活跃日志的关注。

## 3. 技术实现
- **数据转换**: 前端 `buildLogTree` 算法负责将后端的线性日志（通过 `parent_log_id` 和 `toolCallId` 关联）重组为 `LogNode` 树。
- **组件拆分**:
    - `ExecutionFlow`: 主容器。
    - `NodeList`: 递归列表渲染器，负责识别连续的子代理节点并分组。
    - `SubAgentGrid`: 并行任务的容器组件。
    - `AgentCard`: 单个子代理的 UI 组件。

## 4. 预览截图
> (此处可添加实际运行截图)
- **主视图**: 清晰的左侧主流程线。
- **并行任务**: 左右并排的 Agent Cards。
